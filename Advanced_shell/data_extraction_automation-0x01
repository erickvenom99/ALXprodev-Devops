#!/bin/bash

# Objective: Extract Pokémon data from a JSON file and format it into a specific human-readable string.
# Constraints: Must use jq, awk, and sed in the pipeline.

# Define the input file name (from Task 0)
INPUT_FILE="data.json"

# Check if the input file exists
if [ ! -f "$INPUT_FILE" ]; then
    echo "Error: Input file '$INPUT_FILE' not found." >&2
    exit 1
fi

# --- The jq | sed | awk Pipeline ---
# 1. jq: Extract raw data fields (name, type, weight(hg), height(dm)). All are space-separated and typically lowercase.
cat "$INPUT_FILE" | \
    jq -r '"\(.name) \(.types[0].type.name) \(.weight) \(.height)"' | \
    
    # 2. sed: Capitalize the first letter of the first field (the Pokémon Name).
    # e.g., "pikachu electric 60 4" -> "Pikachu electric 60 4"
    sed 's/^\([a-z]\)/\U\1/' | \
    
    # 3. awk: Perform remaining capitalization, unit conversions, and final output formatting.
    awk '
    {
        # Use descriptive variables for clarity:
        name = $1;          # Already capitalized (e.g., Pikachu)
        raw_type = $2;      # (e.g., electric)
        weight_hg = $3;
        height_dm = $4;
        
        # Unit Conversions:
        # Weight: hectograms (hg) / 10 = kilograms (kg)
        formatted_weight = weight_hg / 10;
        # Height: decimeters (dm) / 10 = meters (m)
        formatted_height = height_dm / 10;

        # Capitalize the first letter of the Type field (e.g., "electric" -> "Electric")
        type_case = toupper(substr(raw_type, 1, 1)) substr(raw_type, 2);
        
        # Print the final human-readable string.
        # %s: String
        # %g: General format for weight (prints '6' instead of '6.0' when possible)
        # %.1f: Fixed format with one decimal place for height (prints '0.4')
        printf("%s is of type %s, weighs %gkg, and is %.1fm tall.\n", 
            name, 
            type_case, 
            formatted_weight, 
            formatted_height);
    }'